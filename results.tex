% !TEX root = thesis.tex

%%
%%
%% Results chapter
%%
%%

This chapter describes the results of several experiments, each run with a variation of the same setup.
In each case, we compare the results of 1,000 simulations using several accuracy measures.
Each section describes a set of experiments, which, together, examine the effect of changes to a single variable on the performance of the \gls{dkd}.

\section{Experimental setup}
\label{sec:results:setup}

Each experiment was run on one of \textit{c4.2xlarge} or \textit{c4.4xlarge} instance in Amazon AWS \citep{aws:instancetypes}.
These virtual machines have 8 and 16 virtual CPUs respectively.
This allowed the monte carlo simulations to be sped up by running in 7 or 15 parallel threads using the \texttt{parallel} package in \texttt{R} \citep{r:parallel}.
Randomization in parallel requires the random number stream to be split into separate sub-streams for each thread. 
This was done using the L'Ecuyer-CMRG method \citep{lecuyer2002random}.

Each experiment was run according to a set of parameters that comprised the particular setup.
A table similar to \cref{tab:params:template}, describing the parameter ranges used in these experiments appears at the beginning of each section below.
The first row in the table contains the \textit{population size} or \textit{sizes} used in the experiment.
The second row contains the \textit{population \gls{spread}}, which controls how quickly the population density drops from the peak.
We use the standard deviation \ensuremath\sigma of the bivariate normal distribution for this.
The third row in the the table contains the \textit{population center}, which is the point \((x_1, x_2)\) of the peak of the population distribution.
For a uniform population distribution, the word ``uniform'' appears.
The next row in the table is the \gls{factor}.
This value is used to increase the expected number of cases for each simulation in the experiment.
It is the same \gls{mu} found in \cref{ch:method}.
The fifth row contains the \textit{incident \gls{spread}}, which controls how quickly the incidence risk drops from the peak.
We use the standard deviation \ensuremath\sigma of the bivariate normal distribution for this.
The sixth and last row in the the table contains the \textit{incident center}, which is the point \((x_1, x_2)\) of the peak of the incident risk function.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & 1.0 \\
Population center & (0,0) \\
\Gls{factor} & 100, 200 \\
Incident \gls{spread} & 1.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption{Experimental parameters and example values}
\label{tab:params:template}
\end{table}


The results of the first experiment, uniform population and a uniform intensity,
are described in \autoref{sec:results:unif_100_unif}.
We then made ran several sets of experiments while changing one parameter at a time.
\autoref{sec:results:unif_NCases_1h} compares the results obtained by varying the number of cases.
\autoref{sec:results:unifNpop_1h} compares the results obtained by varying the size of the population.

\section[Effect of number of incidents with fixed population]
    {Effect of number of incidents for a fixed, uniform population of 10,000 and single peak with spread 1.0}
\label{sec:results:number_of_incidents}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table - expected number of incidents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & uniform \\
Population center & uniform \\
\Gls{factor} & 50, 100, 200, 500, 1,000 \\
Incident \gls{spread} & 1.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption[Effect of number of incidents with fixed population]
    {Experimental parameter values varying \gls{factor} for a fixed, uniform population of 10,000 and single peak with spread 1.0}
\label{tab:params:results:number_of_incidents}
\end{table}

First, we examine the effect of sample size on the optimal bandwidth.
According to the theory developed in \cref{sec:theory:bandwidth},
the bandwidth should decrease as the sample size increases according to the formula

\[
    h_{\mymathit{opt}} = O(n^{-\frac{1}{6}})
\]


\input{results/by_h_per_mu/h_per_mu}


\section[Effect of risk spread with fixed population]
    {Effect of risk \gls{spread} for a fixed, uniform population of 10,000 and single peak with \gls{spread} 1.0}
\label{sec:results:spread}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table - spread
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & uniform \\
Population center & uniform \\
\Gls{factor} & 100 \\
Incident \gls{spread} & 0.7, 1.0, 1.4, 2.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption[Effect of spread with fixed population]
    {Experimental parameter values varying \gls{spread} for a fixed, uniform population of 10,000 and single peak with \gls{spread} 1.0}
\label{tab:params:results:spread}
\end{table}

We examine the effect of spread on the optimal bandwidth.
The main effect of increasing spread is that the peak of the risk function becomes less pronounced.
The \gls{oracle}, \gls{silverman}, and \gls{cv} bandwidths all increase as the spread increases.
The \gls{oracle}, \gls{silverman}, and \gls{cv} NMISE decrease as the spread increases.
However, the \gls{oracle} and \gls{cv} decrease faster than than \gls{silverman}.

\input{results/by_h_per_spread/h_per_spread}

\section{Consistency of the DKD}
\label{sec:results:consistency}

\textbf{
\color{red}
This table shows that the method is not consistent.
There is an issue with the CV using gradient descent.
However, even the Oracle and Silverman bandwidths have INCREASING normalized error.
Also note the bandwidths are getting smaller.
}

$$
\lambda(x_1, x_2) = \mu f\!(x_1, x_2)
$$

where $\mu$ is a constant multiplier.
Normalized MISE is MISE divided by $\mu$.

\textbf{
    \color{red}
    Also note that taking the average of the 2 Oracle bandwidths for $\mu=1$ is 1.35,
    and $1.35 \mu^{-1/6}$ gives:
    \\
    1.5153238 \\
    1.3500000 \\
    1.2027133 \\
    1.0323781 \\
    0.9197443
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Results template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Results template}
\label{sec:results:template}
\graphicspath{{./results/unif_100_1.0_1h/}}
\makeatletter
\def\input@path{{./results/unif_100_1.0_1h/}}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Example cases scatter - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.32\textwidth}
    \includegraphics[width=\textwidth]{output/population-heatmap}
    \caption{Population distribution}
    \end{subfigure}
    \begin{subfigure}[t]{0.32\textwidth}
    \includegraphics[width=\textwidth]{output/population-points}
    \caption{Population realization}
    \end{subfigure}%
    \begin{subfigure}[t]{0.32\textwidth}
    \includegraphics[width=\textwidth]{output/population_and_incidents_scatter}
    \caption{With incidents}
    \end{subfigure}%
    \caption[Uniform population distribution]
        {Population distribution (a), realization (b), and sample incidents (c)}
    \label{fig:cases_scatter:template}    
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Example cases heat map - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/true_intensity_heatmap}
    \caption{True incident risk function}
    \end{subfigure}%
    \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/oracle_intensity_heatmap}
    \caption{Incident risk estimate using Oracle bandwidth}
    \end{subfigure}


    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/silverman_intensity_heatmap}
    \caption{Incident risk estimate using Silverman bandwidth}
    \end{subfigure}%
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/CV_intensity_heatmap}
    \caption{Incident risk estimate using Cross-validation bandwidth}
    \end{subfigure}
    \caption[Example incidents: uniform incident risk on uniform population, 100 cases]
        {Example incidents: uniform incident risk on uniform population, 100 cases}
    \label{fig:cases_heatmap:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ISE distribution - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/ise-relative-histogram}
    \caption{Relative ISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/ise-normalized-histogram}
    \caption{Normalized absolute ISE}
    \end{subfigure}
    \caption[ISE: uniform on uniform]{Integrated squared error histogram for uniform intensity on a uniform population, 100 cases}
    \label{fig:ise:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IAE distribution - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/iae-relative-histogram}
    \caption{Relative IAE}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/iae-histogram}
    \caption{Absolute IAE}
    \end{subfigure}
    \caption[IAE: uniform on uniform]{Integrated absolute error histogram for uniform intensity on a uniform population, 100 cases}
    \label{fig:iae:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Max error distribution - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.45\textwidth]{output/maxerr-histogram}
    \caption[Maximum error: uniform on uniform]{Maximum error histogram for uniform intensity on a uniform population, 100 cases}
    \label{fig:maxerr:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Mean errors - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\input{output/mean_table.tex}
\caption{Mean error rates for uniform population, uniform intensity of\gls{factor} 100}
\label{tab:errors:template}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Peaks - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/peak-dist-histogram}
    \caption{Peak distance from truth}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/peak-height-histogram}
    \caption{Peak heights}
    \end{subfigure}
    \caption[Peaks: uniform on uniform]{Peak distance from truth and height histograms for uniform intensity on a uniform population, 100 cases}
    \label{fig:peaks:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Centroids - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/centroid-dist-histogram}
    \caption{Centroid peak distance from truth}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/centroid-height-histogram}
    \caption{Centroid peak heights}
    \end{subfigure}
    \caption[Centroids: uniform on uniform]{Centroid peak distance from truth and height histograms for uniform intensity on a uniform population, 100 cases}
    \label{fig:centroids:template}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bandwidths - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/bandwidths-x1}
    \caption{CV Bandwidths - \(X_1\)}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/bandwidths-x2}
    \caption{CV Bandwidths - \(X_2\)}
    \end{subfigure}

    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/bandwidths-difference}
    \caption{Difference between \(X_1\) and \(X_2\) bandwidths}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{output/bandwidths-silverman}
    \caption{Silverman Bandwidths}
    \end{subfigure}
    \caption[Bandwidths: uniform on uniform]{CV bandwidths: \(X_1\), \(X_2\) and difference and Silverman bandwidth
        histograms for uniform intensity on a uniform population, 100 cases}
    \label{fig:bandwidths:template}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Uniform risk on uniform population section
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Uniform risk on a uniform population}
\label{sec:results:unif_100_unif}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table - template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & uniform \\
\Gls{factor} & 100 \\
Incident \gls{spread} & uniform \\
Incident center & -- \\
\hline
\end{tabular}
\caption{Parameters used in uniform risk on a uniform population}
\label{tab:params:unif_100_unif}
\end{table}

In this section, we describe the results of 1,000 simulations conducted for a population of 10,000 points,
distributed uniformly throughout the study area.
\autoref{fig:cases:unif_100_unif} shows the true uniform intensity function,
together with three estimated intensity functions of a single simulation,
computed using three bandwidths: the oracle bandwidth, the Silverman rule of thumb bandwidth,
and the cross-validation bandwidth.

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/true_intensity_heatmap}
    \caption{True intensity}
    \end{subfigure}%
    \begin{subfigure}[t]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/oracle_intensity_heatmap}
    \caption{Oracle bandwidth estimate}
    \end{subfigure}


    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/silverman_intensity_heatmap}
    \caption{Silverman bandwidth estimate}
    \end{subfigure}%
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/CV_intensity_heatmap}
    \caption{Cross-validation bandwidth estimate}
    \end{subfigure}
    \caption{Example cases: uniform intensity on uniform population, 100 cases}
    \label{fig:cases:unif_100_unif}
\end{figure}

\begin{table}[htbp]
\centering
\input{results/unif_100_unif/output/mean_table.tex}
\caption{Mean error rates for uniform population, uniform intensity of \gls{factor} 100}
\label{tab:errors:unif_100_unif}
\end{table}

\autoref{tab:errors:unif_100_unif} lists the mean error rates obtained for a uniform intensity with \gls{factor} of 100,
over a uniform population of 10,000.
The columns represent the errors observed by using the three different methods for computing the smoothing bandwidth:
the Oracle, the Silverman rule of thumb, and least-squares cross validation.
Each row represents a different measure of error.
Relative MISE is the mean integrated relative squared error,
where the relative squared error is computed in the following manner:
\[ \mbox{RSE}(x) = \left(\frac{\hat{f}(x)-f(x)}{f(x)}\right)^2 .\]
More generally, the relative error at a point \(x\) is computed as
\[ \mbox{RE}(x) =  \frac{\hat{f}(x)-f(x)}{f(x)} .\]
The next row is the mean integrated absolute error (MIAE),
which is followed by Relative MIAE which is computed analogously to Relative MISE.
This is followed by the Maximum error, which is the greatest absolute error over the study area.
Complete results can be found in \autoref{tab:mean_error_rates:unif_100_unif} in \autoref{ch:results_tables}.

The error measures mentioned above each compare the closeness of the estimated intensity function to the true funcition.
The following error measures, on the other hand, relate the closeness of the \textit{peak} of the estimate to the true peak.
The \textit{peak bias} is the average difference between the computed and true maxima,
that is the empirical expectation of \(\max{\{\hat{f}(x)\}} - \max{\{f(x)\}}\).
The Relative peak bias is peak bias expressed relative to the true maximum.
The \textit{peak drift} is the Euclidean distance between the estimated peak and the true peak.
The Relative peak drift is the peak drift, expressed relative to the width of the study area.

The next four measures, \textit{centroid bias} and \textit{drift}, and the relative versions of them, are analogous to the peak error measures.
However, instead of comparing the true peak to the peak of the estimate, they compare it to the location and value of the estimate, calculated at the centroid of the top five percent of the estimated function.

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/ise-relative-histogram}
    \caption{Relative ISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/ise-histogram}
    \caption{Absolute ISE}
    \end{subfigure}
    \caption[ISE: uniform on uniform]{Integrated squared error histogram for uniform intensity on a uniform population, 100 cases}
    \label{fig:ise:unif_100_unif}
\end{figure}

\autoref{fig:ise:unif_100_unif} shows the empirical distribution of the MISE and RMISE for the uniform intensity on uniform population.
The similarity of the distributions for the Oracle, Silverman, and Cross-validation bandwidths
reflects the relative ease with which the DKD can estimate a flat intensity function.

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/bandwidths-silverman}
    \caption{Silverman}
    \label{fig:bandwidths_x1:unif_100_unif:s}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/bandwidths-x1}
    \caption{Cross-validation, \(X_1\)}
    \label{fig:bandwidths_x1:unif_100_unif:x1}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_unif/output/bandwidths-x2}
    \caption{Cross-validation, \(X_2\)}
    \label{fig:bandwidths_x1:unif_100_unif:x2}
    \end{subfigure}
    \caption{Bandwidth histograms for 100 incidents (uniform) from population of 10,000}
\end{figure}


%%
%% Section
\section{Varying the number of incidents}
\label{sec:results:unif_NCases_1h}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & uniform \\
\Gls{factor} & 50, 100, 200, 500, 1000 \\
Incident \gls{spread} & 1.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption{Parameters used for varying the number of incidents}
\label{tab:params:unif_NCases_1h}
\end{table}

In this section we examine and compare the results of experiments where the number of incidents is varied, while keeping the population size constant at 10,000, distributed uniformly throughout the study area.
The expected incident sizes used in the experiments in this section were 50, 100, 200, 500, and 1,000.
The full set of error measures for these cases can be found in \autoref{tab:mean_error_rates:unif_50_1.0_1h}, \autoref{tab:mean_error_rates:unif_100_1.0_1h}, \autoref{tab:mean_error_rates:unif_200_1.0_1h}, \autoref{tab:mean_error_rates:unif_500_1.0_1h}, and \autoref{tab:mean_error_rates:unif_100_1.0_1h} in \autoref{ch:results_tables}.


\begin{figure}[htbp]
    \centering
    \begin{subfigure}{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_1.0_1h/output/population_and_incidents_scatter}
    \caption{100 incidents}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
    \includegraphics[width=\textwidth]{results/unif_500_1.0_1h/output/population_and_incidents_scatter}
    \caption{500 incidents}
    \end{subfigure}
    \caption{A single realization of different sizes from a single-peak risk on a uniform population}
    \label{fig:one_sample:unif_NCases_1h}
\end{figure}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_num_cases/MISE-vs-cases}
    \caption{MISE}
    \label{fig:ise:unif_NCases_1h:a}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_num_cases/RMISE-vs-cases}
    \caption{Relative MISE}
    \label{fig:ise:unif_NCases_1h:b}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_num_cases/RMISE-vs-cases-log-log}
    \caption{Relative MISE log-log}
    \label{fig:ise:unif_NCases_1h:c}
    \end{subfigure}
    \caption[MISE: by number of cases]{Mean Integrated Squared Error vs. number of cases}
    \label{fig:ise:unif_NCases_1h}
\end{figure}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_1.0_1h/output/bandwidths-silverman}
    \caption{Silverman}
    \label{fig:bandwidths_x1:unif_100_1.0_1h:s}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_1.0_1h/output/bandwidths-x1}
    \caption{Cross-validation, \(X_1\)}
    \label{fig:bandwidths_x1:unif_100_1.0_1h:x1}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/unif_100_1.0_1h/output/bandwidths-x2}
    \caption{Cross-validation, \(X_2\)}
    \label{fig:bandwidths_x1:unif_100_1.0_1h:x2}
    \end{subfigure}
    \caption{Bandwidth histograms for 100 incidents in a single peak from population of 10,000}
\end{figure}

\autoref{fig:one_sample:unif_NCases_1h} shows how one realization of incidents, distributed over the population, for sample sizes of 100 and 500.
This is done by multiplying the single-peak risk function by a constant in order to control the expected number of incidents per simulation.
\autoref{fig:ise:unif_NCases_1h} shows the effect on the MISE and RMISE:
\autoref{fig:ise:unif_NCases_1h:a} shows how MISE increases with expected incidents per patient.
One might expect the error to associated with estimating a function to \textit{decrease} as the number of incidents increases.
However, the expected number of incidents increases linearly with the intensity function value.
For example, double the number of incidents corresponds to an intensity of twice the value.
This makes comparing the MISE of estimates of intensity functions difficult, as the errors will also rise in the same direction.
In order to facilitate the comparison of intensity functions that have different expected number of incidents, we use the RMISE.
\autoref{fig:ise:unif_NCases_1h:b} shows how RMISE decreases with expected incidents per patient.
\autoref{fig:ise:unif_NCases_1h:c} is a log-log graph, showing a linear relationship between the logarithm of RMISE and the logarithm of the number of cases.
The values of the intercept and slope are -2.3525396 and -0.7316768 for the Oracle bandwidth; -1.8623772 and -0.7356884 for the Silverman bandwidth; and -1.5308541 and -0.8103349 for the cross-validation bandwidth.
The corresponding equations for RMISE are:

\begin{align}
    \mbox{RMISE}_{oracle} &= 0.09512727 N^{-0.7316768} \\
    \mbox{RMISE}_{silverman} &= 0.155303 N^{-0.7356884} \\
    \mbox{RMISE}_{cv} &= 0.2163508 N^{-0.8103349}
\end{align}

\textcolor{red}{TBD: chart of bandwidth vs. no. cases}

\begin{table}
\centering
\begin{tabular}{rrrr}
    \hline
    Incident risk function \gls{spread} & Oracle & Silverman & CV \\ 
    \hline
    1.0 & -0.8180b & -0.7445 & 4.2668 \\
    1.4 & -0.7501 & -0.7224 & -0.5711 \\
    2.0 & -0.7548 & -0.7253 & -0.8425 \\
    \( \infty \) & -0.7317 & -0.7357 & -0.8103
\end{tabular}
\caption{Convergence power for different incident risk function spreads}
\label{tab:convergence_vs_spread}
\end{table}

%%
%% Section
\section{Varying the sample size for fixed intensity}
\label{sec:results:unifNpop_1h}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000, 20,000, 40,000, 60,000, 80,000, 100,000 \\
Population \gls{spread} & uniform \\
\Gls{factor} & 100, 200, 400, 600, 800, 1000 \\
Incident \gls{spread} & 1.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption{Parameters used for varying the sample size for fixed intensity}
\label{tab:params:unifNpop_1h}
\end{table}


We next examine the effect of increasing the sample size, while keeping the risk intensity function fixed.
In order to do this, we increase the population size and the expected number of incidents proportionately.
For this set of experiments, the population is uniformly distributed and the risk intensity has a single peak in the center with a fixed \gls{spread} (standard deviation).

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_size/MISE-vs-population}
    \caption{MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_size/RMISE-vs-population}
    \caption{Relative MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_size/RMISE-vs-population-log-log}
    \caption{Relative MISE log-log}
    \end{subfigure}
    \caption[MISE: by population size]{Mean Integrated Squared Error vs. population size}
    \label{fig:ise:unifNpop_1h}
\end{figure}


%%
%% Section
\section{Varying the spread of the risk function}
\label{sec:results:unif_100_SD}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Parameter table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
\centering
\begin{tabular}{ll}
\hline
Parameter & Value \\
\hline
Population size & 10,000 \\
Population \gls{spread} & uniform \\
\Gls{factor} & 100 \\
Incident \gls{spread} & 0.7, 1.0, 1.4, 2.0 \\
Incident center & (0,0) \\
\hline
\end{tabular}
\caption{Parameters used for varying the \gls{spread} of the risk function}
\label{tab:params:unif_100_SD}
\end{table}

In this section, we compare the effect of the \gls{spread} of the risk function on the estimate.
The population distribution is uniform, and the \gls{factor} remains constant at 100, but
the standard deviation of the Gaussian risk function is varied.

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_cases_spread/MISE-vs-risk-spread}
    \caption{MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_cases_spread/RMISE-vs-risk-spread}
    \caption{Relative MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_cases_spread/RMISE-vs-risk-spread-log-log}
    \caption{Relative MISE log-log}
    \end{subfigure}
    \caption[MISE: by risk spread]{Mean Integrated Squared Error vs. risk spread}
    \label{fig:ise:unif_100_SD}
\end{figure}

%%
%% Section
\section{Varying the spread of the population density}
\label{sec:results:pSD_100_1h}

In this section, we compare the effect of different population distributions on the estimation of a single, fixed risk function.
The population s
The risk function has an \gls{factor} of 100.

\begin{table}[htbp]
\centering
\input{results/p0.7_100_1.0_1h/output/mean_table.tex}
\caption{Error rates for uniform population of 10,000, single peak intensity of \gls{factor} 100 and \gls{spread} 0.7}
\label{tab:results:p0.7_100_1.0_1h}
\end{table}


\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_population_spread/MISE-vs-population-spread}
    \caption{MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_population_spread/RMISE-vs-population-spread}
    \caption{Relative MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_population_spread/RMISE-vs-population-spread-log-log}
    \caption{Relative MISE log-log}
    \end{subfigure}
    \caption[MISE: by risk spread]{Mean Integrated Squared Error vs. population spread}
    \label{fig:ise:pSD_100_1h}
\end{figure}


%%
%% Section
\section{Distance between two peaks}
\label{sec:results:p1.4_100_G}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_two_peaks/MISE-vs-risk-peak-gap}
    \caption{MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_two_peaks/RMISE-vs-risk-peak-gap}
    \caption{Relative MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_two_peaks/RMISE-vs-risk-peak-gap-log-log}
    \caption{Relative MISE log-log}
    \end{subfigure}
    \caption[MISE: by risk spread]{Mean Integrated Squared Error vs. distance between two risk peaks}
    \label{fig:ise:p1.4_100_G}
\end{figure}

%%
%% Section
\section{Distance between the population and risk function peaks}
\label{sec:ise:p1.4_Gap_risk}

\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_risk_distance/MISE-vs-population-risk-gap}
    \caption{MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_risk_distance/RMISE-vs-population-risk-gap}
    \caption{Relative MISE}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
    \includegraphics[width=\textwidth]{results/by_pop_risk_distance/RMISE-vs-population-risk-gap-log-log}
    \caption{Relative MISE log-log}
    \end{subfigure}
    \caption[MISE: by distance between population and risk peaks]{Mean Integrated Squared Error vs. distance between population and risk peaks}
    \label{fig:ise:p1.4_Gap_risk}
\end{figure}

\graphicspath{{./}}
